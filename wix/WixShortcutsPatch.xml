<CPackWiXPatch>
  <CPackWiXFragment Id="#PRODUCT">
    <Property Id="INSTALLDESKTOPSHORTCUT" Value="1" />
    <Property Id="INSTALLSTARTMENUSHORTCUT" Value="1" />

    <DirectoryRef Id="TARGETDIR">
      <Directory Id="DesktopFolder" Name="Desktop" />
      <Directory Id="ProgramMenuFolder" Name="Programs" />
    </DirectoryRef>

    <UI>
      <Dialog Id="ShortcutOptionsDlg" Width="370" Height="270" Title="[ProductName] Setup">
        <Control Id="Title" Type="Text" X="15" Y="6" Width="340" Height="15" Transparent="yes" NoPrefix="yes" Text="Shortcut Options" />
        <Control Id="Description" Type="Text" X="20" Y="23" Width="330" Height="25" Transparent="yes" NoPrefix="yes" Text="Choose which shortcuts will be created." />
        <Control Id="BannerLine" Type="Line" X="0" Y="55" Width="370" Height="0" />

        <Control
          Id="DesktopShortcutCheckBox"
          Type="CheckBox"
          X="20"
          Y="80"
          Width="330"
          Height="17"
          Property="INSTALLDESKTOPSHORTCUT"
          CheckBoxValue="1"
          Text="Create Desktop shortcut" />

        <Control
          Id="StartMenuShortcutCheckBox"
          Type="CheckBox"
          X="20"
          Y="100"
          Width="330"
          Height="17"
          Property="INSTALLSTARTMENUSHORTCUT"
          CheckBoxValue="1"
          Text="Create Start Menu shortcut" />

        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="Back">
          <Publish Event="NewDialog" Value="InstallDirDlg">1</Publish>
        </Control>
        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="Next">
          <Publish Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
        </Control>
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="Cancel">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>
      </Dialog>

      <Publish Dialog="InstallDirDlg" Control="Next" Event="NewDialog" Value="ShortcutOptionsDlg" Order="999">1</Publish>
    </UI>

    <DirectoryRef Id="INSTALL_ROOT">
      <Component Id="CM_CP_DesktopShortcut" Guid="*">
        <Condition>INSTALLDESKTOPSHORTCUT="1"</Condition>
        <Shortcut
          Id="ShortcutDesktopVtkRenderer"
          Directory="DesktopFolder"
          Name="VtkRenderer"
          Target="[INSTALL_ROOT]bin\VtkRenderer.exe"
          WorkingDirectory="INSTALL_ROOT"
          Icon="ProductIcon.ico"
          IconIndex="0"
          Advertise="no" />
        <RegistryValue
          Root="HKCU"
          Key="Software\VtkRenderer"
          Name="DesktopShortcut"
          Type="integer"
          Value="1"
          KeyPath="yes" />
      </Component>

      <Component Id="CM_CP_StartMenuShortcut" Guid="*">
        <Condition>INSTALLSTARTMENUSHORTCUT="1"</Condition>
        <Shortcut
          Id="ShortcutStartMenuVtkRenderer"
          Directory="ProgramMenuFolder"
          Name="VtkRenderer"
          Target="[INSTALL_ROOT]bin\VtkRenderer.exe"
          WorkingDirectory="INSTALL_ROOT"
          Icon="ProductIcon.ico"
          IconIndex="0"
          Advertise="no" />
        <RegistryValue
          Root="HKCU"
          Key="Software\VtkRenderer"
          Name="StartMenuShortcut"
          Type="integer"
          Value="1"
          KeyPath="yes" />
      </Component>
    </DirectoryRef>
  </CPackWiXFragment>

  <CPackWiXFragment Id="#PRODUCTFEATURE">
    <ComponentRef Id="CM_CP_DesktopShortcut" />
    <ComponentRef Id="CM_CP_StartMenuShortcut" />
  </CPackWiXFragment>
</CPackWiXPatch>

